/**
 * Created by 龙鸿轩 on 2016/4.
 * 执行查询table1所有信息
 */
var express = require('express');
var dbHelper = require('./dbHelper.js');
var router = express.Router();
/* GET home page. */
//查询所有用户信息
router.get('/', function (req, res, next) {

    dbHelper.selectAll('dbo.table1', function (err,result) { // 第一个是表名，第二个是回调函数
        //console.log(result);
        res.render('userinfo',{result:result});
    });
});
//执行删除
router.get('/delete/:id', function (req, res, next) {
    //console.log("----------------------");
    var idd = req.param("id");
    //console.log(idd);
    dbHelper.del("where id = @id", {id: idd}, 'dbo.table1', function (err, result) {
        //console.log(result);
        //res.render('userinfo', {result: result});
        res.redirect('/userinfo');

    });
});
router.get('/toupdate/:id', function (req, res, next) {
    //console.log("----------------------");
    var idd = req.param("id");
    console.log(idd);

    dbHelper.select("dbo.table1",1,"where id=@id",{id: idd},"order by id",function(err,result){
        console.log(result);
        res.render('update',{result:result});
    });
});
//执行修改
router.get('/update/:id?/:name?', function (req, res, next) {
    //console.log("#########");
    var idd = req.param("id");
    var name = req.param("name");
    dbHelper.update({name:name},{id:idd},"dbo.table1",function(err,recordset){
        res.redirect('/userinfo');
    });
});
//执行添加
router.get('/add/:name',function(req,res,next){
    console.log("#");
    var names=req.param("name");
    dbHelper.add({name:names},"dbo.table1",function(err,recordset){
        res.redirect('/userinfo');
    });
});
//执行添加
router.get('/toaddurl',function(req,res,next){
    res.render('add');
});
module.exports = router;

